package Menu;

import Model.*;
import Service.*;
import Service.RekamMedisDokter.RekamMedisView;
import java.util.*;

public class MenuDokter {
    private final Scanner input = new Scanner(System.in);
    private final RekamMedisDokter serviceRekam = new RekamMedisDokter();
    private final Laporan serviceLaporan = new Laporan();
    
    public void tampilMenu(Dokter dokter) {
        int pilihan;
        do {
            System.out.println("\n=== MENU DOKTER ===");
            System.out.println("Selamat datang, dr. " + dokter.getNama());
            System.out.println("1. Dashboard");
            System.out.println("2. Laporan Kesehatan");
            System.out.println("3. Rekam Medis");
            System.out.println("4. Logout");
            System.out.print("Pilih: ");
            
            try {
                pilihan = Integer.parseInt(input.nextLine());
            } catch (NumberFormatException e) {
                System.out.println("âŒ Input harus berupa angka!");
                pilihan = 0;
                continue;
            }

            switch (pilihan) {
                case 1:
                    tampilDashboard(dokter);
                    break;
                case 2:
                    tampilMenuLaporan(dokter);
                    break;
                case 3:
                    tampilMenuRekamMedis(dokter);
                    break;
                case 4:
                    System.out.println("Logout...");
                    return;
                default:
                    System.out.println("âŒ Pilihan tidak valid, coba lagi!");
            }
        } while (pilihan != 4);
    }

    // âœ… DASHBOARD (Coming Soon)
    private void tampilDashboard(Dokter dokter) {
        System.out.println("\n=== DASHBOARD ===");
        System.out.println("ğŸ“Š Fitur dashboard akan segera hadir!");
        System.out.println("Tekan Enter untuk kembali...");
        input.nextLine();
    }

    // âœ… MENU LAPORAN KESEHATAN (READ-ONLY untuk Dokter)
    private void tampilMenuLaporan(Dokter dokter) {
        int pilihan;
        do {
            System.out.println("\n=== LAPORAN KESEHATAN ===");
            System.out.println("1. Lihat Semua Laporan");
            System.out.println("2. Cari Laporan (berdasarkan nama lansia)");
            System.out.println("3. Kembali");
            System.out.print("Pilih: ");
            
            try {
                pilihan = Integer.parseInt(input.nextLine());
            } catch (NumberFormatException e) {
                System.out.println("âŒ Input harus berupa angka!");
                pilihan = 0;
                continue;
            }

            switch (pilihan) {
                case 1:
                    lihatSemuaLaporan();
                    break;
                case 2:
                    cariLaporan();
                    break;
                case 3:
                    System.out.println("Kembali ke menu utama...");
                    return;
                default:
                    System.out.println("âŒ Pilihan tidak valid, coba lagi!");
            }
        } while (pilihan != 3);
    }

    // âœ… LIHAT SEMUA LAPORAN (Format Tabel)
    private void lihatSemuaLaporan() {
        List<LaporanKesehatan> list = serviceLaporan.lihatSemuaLaporan();
        
        if (list.isEmpty()) {
            System.out.println("ğŸ“‹ Belum ada data laporan.");
            return;
        }

        System.out.println("\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—");
        System.out.println("â•‘                                    DAFTAR LAPORAN KESEHATAN                                      â•‘");
        System.out.println("â• â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£");
        System.out.println("â•‘ ID     â•‘ Tanggal      â•‘ Nama Lansia           â•‘ Keluhan               â•‘ Tindakan                  â•‘");
        System.out.println("â• â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£");
        
        for (LaporanKesehatan l : list) {
            Lansia ln = l.getLansia();
            System.out.printf("â•‘ %-6d â•‘ %-12s â•‘ %-21s â•‘ %-21s â•‘ %-25s â•‘%n",
                l.getIdLaporan(),
                l.getTanggalPeriksa(),
                truncate(ln.getNama(), 21),
                truncate(l.getKeluhan(), 21),
                truncate(l.getTindakan(), 25)
            );
        }
        
        System.out.println("â•šâ•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
        System.out.println("Total: " + list.size() + " laporan");
    }

    // âœ… CARI LAPORAN (Format Tabel)
    private void cariLaporan() {
        System.out.println("\n=== CARI LAPORAN ===");
        System.out.print("Masukkan nama lansia: ");
        String nama = input.nextLine();
        
        if (nama.trim().isEmpty()) {
            System.out.println("âŒ Nama tidak boleh kosong!");
            return;
        }
        
        List<LaporanKesehatan> hasil = serviceLaporan.cariLaporanByNamaLansia(nama);

        if (hasil.isEmpty()) {
            System.out.println("ğŸ“‹ Tidak ada laporan untuk nama tersebut.");
            return;
        }

        System.out.println("\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—");
        System.out.println("â•‘                                HASIL PENCARIAN LAPORAN KESEHATAN                                 â•‘");
        System.out.println("â• â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£");
        System.out.println("â•‘ ID     â•‘ Tanggal      â•‘ Nama Lansia           â•‘ Keluhan               â•‘ Tindakan                  â•‘");
        System.out.println("â• â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£");
        
        for (LaporanKesehatan l : hasil) {
            Lansia ln = l.getLansia();
            System.out.printf("â•‘ %-6d â•‘ %-12s â•‘ %-21s â•‘ %-21s â•‘ %-25s â•‘%n",
                l.getIdLaporan(),
                l.getTanggalPeriksa(),
                truncate(ln.getNama(), 21),
                truncate(l.getKeluhan(), 21),
                truncate(l.getTindakan(), 25)
            );
        }
        
        System.out.println("â•šâ•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
        System.out.println("Total: " + hasil.size() + " laporan ditemukan");
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // MENU REKAM MEDIS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    public void tampilMenuRekamMedis(Dokter dokter) {
        int pilihan;
        do {
            System.out.println("\n=== MENU REKAM MEDIS ===");
            System.out.println("1. Tambah Rekam Medis");
            System.out.println("2. Lihat Semua Rekam Medis");
            System.out.println("3. Update Rekam Medis");
            System.out.println("4. Hapus Rekam Medis");
            System.out.println("5. Cari Rekam Medis (berdasarkan nama lansia)");
            System.out.println("6. Kembali");
            System.out.print("Pilih: ");
            
            try {
                pilihan = Integer.parseInt(input.nextLine());
            } catch (NumberFormatException e) {
                System.out.println("âŒ Input harus berupa angka!");
                pilihan = 0;
                continue;
            }

            switch (pilihan) {
                case 1:
                    tambahRekamMedis(dokter);
                    break;
                case 2:
                    lihatSemuaRekamMedis();
                    break;
                case 3:
                    ubahRekamMedis();
                    break;
                case 4:
                    hapusRekamMedis();
                    break;
                case 5:
                    cariRekamMedis();
                    break;
                case 6:
                    System.out.println("Kembali ke menu utama...");
                    return;
                default:
                    System.out.println("âŒ Pilihan tidak valid, coba lagi!");
            }
        } while (pilihan != 6);
    }

    // âœ… CREATE - Tambah Rekam Medis
    private void tambahRekamMedis(Dokter dokter) {
        try {
            System.out.println("\n=== TAMBAH REKAM MEDIS ===");

            System.out.print("ID Lansia: ");
            int idLansia = Integer.parseInt(input.nextLine());

            System.out.print("Diagnosis: ");
            String diagnosis = input.nextLine();

            if (diagnosis.trim().isEmpty()) {
                System.out.println("âŒ Diagnosis tidak boleh kosong!");
                return;
            }

            System.out.print("Tindakan: ");
            String tindakan = input.nextLine();

            if (tindakan.trim().isEmpty()) {
                System.out.println("âŒ Tindakan tidak boleh kosong!");
                return;
            }

            boolean status = serviceRekam.tambahRekamMedisDokter(
                idLansia, diagnosis, tindakan, dokter.getId()
            );

            if (status) {
                System.out.println("âœ… Rekam medis berhasil ditambahkan!");
            } else {
                System.out.println("âŒ Gagal menambahkan rekam medis!");
            }

        } catch (NumberFormatException e) {
            System.out.println("âŒ ID Lansia harus berupa angka!");
        } catch (Exception e) {
            System.out.println("âŒ Kesalahan: " + e.getMessage());
        }
    }

    // âœ… READ - Lihat Semua Rekam Medis (Format Tabel)
    private void lihatSemuaRekamMedis() {
        List<RekamMedisView> list = serviceRekam.lihatSemuaRekamMedisWithDokter();
        
        if (list.isEmpty()) {
            System.out.println("ğŸ“‹ Belum ada data rekam medis.");
            return;
        }

        System.out.println("\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—");
        System.out.println("â•‘                                           DAFTAR REKAM MEDIS                                                       â•‘");
        System.out.println("â• â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£");
        System.out.println("â•‘ ID    â•‘ Tanggal      â•‘ Nama Lansia           â•‘ Diagnosis             â•‘ Tindakan              â•‘ Dokter                â•‘");
        System.out.println("â• â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£");
        
        for (RekamMedisView rm : list) {
            System.out.printf("â•‘ %-5d â•‘ %-12s â•‘ %-21s â•‘ %-21s â•‘ %-21s â•‘ dr. %-18sâ•‘%n",
                rm.getIdRekam(),
                rm.getTanggalPemeriksaan(),
                truncate(rm.getNamaLansia(), 21),
                truncate(rm.getDiagnosis(), 21),
                truncate(rm.getTindakan(), 21),
                truncate(rm.getNamaDokter(), 18)
            );
        }
        
        System.out.println("â•šâ•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
        System.out.println("Total: " + list.size() + " rekam medis");
    }

    // âœ… UPDATE - Ubah Rekam Medis
    private void ubahRekamMedis() {
        try {
            System.out.println("\n=== UPDATE REKAM MEDIS ===");
            System.out.print("Masukkan ID Rekam Medis: ");
            int idRekam = Integer.parseInt(input.nextLine());

            System.out.print("Diagnosis baru: ");
            String diagnosis = input.nextLine();
            
            if (diagnosis.trim().isEmpty()) {
                System.out.println("âŒ Diagnosis tidak boleh kosong!");
                return;
            }

            System.out.print("Tindakan baru: ");
            String tindakan = input.nextLine();
            
            if (tindakan.trim().isEmpty()) {
                System.out.println("âŒ Tindakan tidak boleh kosong!");
                return;
            }

            serviceRekam.updateRekamMedis(idRekam, diagnosis, tindakan);
            
        } catch (NumberFormatException e) {
            System.out.println("âŒ ID Rekam Medis harus berupa angka!");
        } catch (Exception e) {
            System.out.println("âŒ Kesalahan input: " + e.getMessage());
        }
    }

    // âœ… DELETE - Hapus Rekam Medis
    private void hapusRekamMedis() {
        try {
            System.out.println("\n=== HAPUS REKAM MEDIS ===");
            System.out.print("Masukkan ID Rekam Medis: ");
            int idRekam = Integer.parseInt(input.nextLine());
            
            System.out.print("Apakah Anda yakin ingin menghapus? (y/n): ");
            String konfirmasi = input.nextLine();
            
            if (konfirmasi.equalsIgnoreCase("y")) {
                serviceRekam.hapusRekamMedis(idRekam);
            } else {
                System.out.println("âš ï¸ Penghapusan dibatalkan.");
            }
            
        } catch (NumberFormatException e) {
            System.out.println("âŒ ID Rekam Medis harus berupa angka!");
        } catch (Exception e) {
            System.out.println("âŒ Kesalahan input: " + e.getMessage());
        }
    }

    // âœ… SEARCH - Cari Rekam Medis (Format Tabel)
    private void cariRekamMedis() {
        System.out.println("\n=== CARI REKAM MEDIS ===");
        System.out.print("Masukkan nama lansia: ");
        String nama = input.nextLine();
        
        if (nama.trim().isEmpty()) {
            System.out.println("âŒ Nama tidak boleh kosong!");
            return;
        }
        
        List<RekamMedisView> hasil = serviceRekam.cariRekamMedisByNamaLansia(nama);

        if (hasil.isEmpty()) {
            System.out.println("ğŸ“‹ Tidak ada rekam medis untuk nama tersebut.");
            return;
        }

        System.out.println("\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—");
        System.out.println("â•‘                                      HASIL PENCARIAN REKAM MEDIS                                                   â•‘");
        System.out.println("â• â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£");
        System.out.println("â•‘ ID    â•‘ Tanggal      â•‘ Nama Lansia           â•‘ Diagnosis             â•‘ Tindakan              â•‘ Dokter                â•‘");
        System.out.println("â• â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£");
        
        for (RekamMedisView rm : hasil) {
            System.out.printf("â•‘ %-5d â•‘ %-12s â•‘ %-21s â•‘ %-21s â•‘ %-21s â•‘ dr. %-18sâ•‘%n",
                rm.getIdRekam(),
                rm.getTanggalPemeriksaan(),
                truncate(rm.getNamaLansia(), 21),
                truncate(rm.getDiagnosis(), 21),
                truncate(rm.getTindakan(), 21),
                truncate(rm.getNamaDokter(), 18)
            );
        }
        
        System.out.println("â•šâ•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
        System.out.println("Total: " + hasil.size() + " rekam medis ditemukan");
    }

    // âœ… HELPER - Truncate string untuk fit di tabel
    private String truncate(String text, int maxLength) {
        if (text == null) return "";
        if (text.length() <= maxLength) return text;
        return text.substring(0, maxLength - 3) + "...";
    }
}
